<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Axitome</title>
<meta name="description" content="One quote. Every day. Let it sit with you.">
<meta property="og:title" content="Axitome">
<meta property="og:description" content="One quote. Every day. Let it sit with you.">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,500;0,600;1,400;1,500&family=DM+Sans:ital,wght@0,200;0,300;0,400;0,500;1,300&family=JetBrains+Mono:wght@200;300&display=swap" rel="stylesheet">
<style>
*,*::before,*::after{margin:0;padding:0;box-sizing:border-box}
:root{
  --bg:#111010;--bg-warm:#161413;--surface:#1e1c1a;--surface-hi:#252220;
  --cream:#f5f1eb;--cream-dim:rgba(245,241,235,0.7);
  --cream-faint:rgba(245,241,235,0.22);--cream-ghost:rgba(245,241,235,0.06);
  --gold:#c8a86e;--gold-dim:rgba(200,168,110,0.5);--heart:#c75050;
}
html{height:100%}
body{min-height:100%;background:var(--bg);color:var(--cream);font-family:'DM Sans',sans-serif;overflow-x:hidden;-webkit-font-smoothing:antialiased}
.grain{position:fixed;inset:0;z-index:100;pointer-events:none;opacity:.03;background-image:url("data:image/svg+xml,%3Csvg viewBox='0 0 512 512' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)'/%3E%3C/svg%3E");background-size:256px}
.ambient{position:fixed;top:-30%;left:50%;transform:translateX(-50%);width:120vw;height:60vh;z-index:0;background:radial-gradient(ellipse at center,rgba(200,168,110,.04) 0%,transparent 60%);pointer-events:none}
.header{position:fixed;top:0;left:0;right:0;z-index:50;display:flex;justify-content:space-between;align-items:center;padding:1.5rem 2rem;background:linear-gradient(to bottom,var(--bg) 50%,transparent)}
.brand{font-weight:200;font-size:.65rem;letter-spacing:.4em;text-transform:uppercase;color:var(--cream-dim);cursor:pointer;transition:color .3s}
.brand:hover{color:var(--cream)}
.menu-btn{background:none;border:none;color:var(--cream-dim);cursor:pointer;padding:.5rem;transition:color .3s;display:flex;flex-direction:column;gap:4px}
.menu-btn:hover{color:var(--cream)}
.menu-btn span{display:block;width:20px;height:1.5px;background:currentColor;transition:all .3s ease}
.menu-btn.open span:nth-child(1){transform:translateY(5.5px) rotate(45deg)}
.menu-btn.open span:nth-child(2){opacity:0}
.menu-btn.open span:nth-child(3){transform:translateY(-5.5px) rotate(-45deg)}
.panel-overlay{position:fixed;inset:0;z-index:60;background:rgba(0,0,0,.6);opacity:0;pointer-events:none;transition:opacity .4s ease}
.panel-overlay.open{opacity:1;pointer-events:auto}
.panel{position:fixed;top:0;right:0;bottom:0;width:340px;max-width:88vw;z-index:70;background:var(--bg-warm);border-left:1px solid var(--cream-faint);transform:translateX(100%);transition:transform .4s cubic-bezier(.16,1,.3,1);display:flex;flex-direction:column;overflow:hidden}
.panel.open{transform:translateX(0)}
.panel-header{padding:1.5rem 1.5rem 0}
.panel-title{font-family:'Playfair Display',serif;font-weight:400;font-size:1.05rem;color:var(--cream);margin-bottom:1.5rem}
.panel-search-wrap{position:relative;margin-bottom:1rem}
.panel-search{width:100%;background:var(--surface);border:1px solid var(--cream-faint);color:var(--cream);padding:.7rem .9rem .7rem 2.3rem;border-radius:8px;font-family:'DM Sans',sans-serif;font-size:.78rem;font-weight:300;outline:none;transition:border-color .3s}
.panel-search:focus{border-color:var(--gold-dim)}
.panel-search::placeholder{color:rgba(240,235,227,.2)}
.panel-search-icon{position:absolute;left:.75rem;top:50%;transform:translateY(-50%);color:var(--cream-faint);width:14px;height:14px}
.panel-body{flex:1;overflow-y:auto;padding:0 1.5rem 1.5rem}
.panel-body::-webkit-scrollbar{width:3px}
.panel-body::-webkit-scrollbar-thumb{background:var(--cream-faint);border-radius:3px}
.section-label{font-size:.55rem;letter-spacing:.3em;text-transform:uppercase;color:rgba(240,235,227,.25);margin:1.5rem 0 .8rem;font-weight:400}
.section-label:first-child{margin-top:.5rem}
.theme-list{list-style:none}
.theme-item{display:flex;justify-content:space-between;align-items:center;padding:.65rem .2rem;border-bottom:1px solid rgba(240,235,227,.04);cursor:pointer;transition:all .25s}
.theme-item:hover{padding-left:.5rem}
.theme-item:hover .theme-name{color:var(--cream)}
.theme-name{font-weight:300;font-size:.8rem;color:var(--cream-dim);transition:color .25s;text-transform:capitalize}
.theme-count{font-family:'JetBrains Mono',monospace;font-size:.55rem;font-weight:200;color:rgba(240,235,227,.2);letter-spacing:.05em}
.theme-meta{display:flex;align-items:center;gap:.4rem}
.theme-arrow{color:rgba(240,235,227,.15);font-size:.7rem;transition:color .25s}
.theme-item:hover .theme-arrow{color:var(--gold-dim)}
.date-section{margin-top:.3rem}
.date-input{width:100%;background:var(--surface);border:1px solid var(--cream-faint);color:var(--cream);padding:.7rem .9rem;border-radius:8px;font-family:'DM Sans',sans-serif;font-size:.8rem;font-weight:300;outline:none;transition:border-color .3s;color-scheme:dark}
.date-input:focus{border-color:var(--gold-dim)}
.date-go-btn{width:100%;background:var(--gold);border:none;color:var(--bg);padding:.65rem;border-radius:8px;cursor:pointer;font-family:'DM Sans',sans-serif;font-weight:400;font-size:.72rem;letter-spacing:.1em;transition:background .3s;margin-top:.6rem}
.date-go-btn:hover{background:#d4b578}
.date-range-hint{font-size:.55rem;color:rgba(240,235,227,.2);letter-spacing:.1em;margin-top:.6rem;text-align:center}

.scene{min-height:100vh;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:6rem 2rem 10rem;position:relative;z-index:1}
.scene.hidden{display:none}
.card{max-width:680px;width:100%;text-align:center;opacity:0;transform:translateY(24px);animation:cardIn 1s .15s cubic-bezier(.16,1,.3,1) forwards}
@keyframes cardIn{to{opacity:1;transform:translateY(0)}}
.card.exit{animation:cardOut .4s cubic-bezier(.55,0,1,.45) forwards!important}
@keyframes cardOut{to{opacity:0;transform:translateY(-14px) scale(.98)}}
.date-label{font-weight:300;font-size:.65rem;letter-spacing:.35em;text-transform:uppercase;color:rgba(245,241,235,.35);margin-bottom:2.5rem}
.today-dot{display:inline-block;width:5px;height:5px;background:var(--gold);border-radius:50%;margin-right:.6rem;vertical-align:middle;animation:dotPulse 2.5s ease-in-out infinite}
@keyframes dotPulse{0%,100%{opacity:.4}50%{opacity:1}}
.quote-wrap{margin-bottom:1.5rem}
.qmark{font-family:'Playfair Display',serif;font-size:3.5rem;line-height:1;color:var(--gold-dim);display:block;user-select:none}
.qmark.open{margin-bottom:.5rem}.qmark.close{margin-top:.4rem}
.quote{font-family:'Playfair Display',serif;font-weight:400;font-style:italic;font-size:clamp(1.2rem,3vw,1.85rem);line-height:1.8;color:var(--cream);text-wrap:balance}
.attribution{display:flex;flex-direction:column;align-items:center;gap:.6rem;margin-bottom:3rem}
.rule{width:32px;height:1px;background:linear-gradient(90deg,transparent,var(--gold-dim),transparent)}
.author{font-weight:300;font-size:.75rem;letter-spacing:.25em;text-transform:uppercase;color:var(--cream-dim)}
.quote-tags{display:none}
.quote-tag{font-size:.5rem;letter-spacing:.15em;text-transform:uppercase;color:var(--gold-dim);opacity:.5;cursor:pointer;transition:opacity .3s}
.quote-tag:hover{opacity:1}
.quote-tag::before{content:'#'}
.actions{display:flex;align-items:center;justify-content:center;gap:.5rem;margin-top:.5rem}
.action-btn{background:var(--cream-ghost);border:1px solid var(--cream-faint);color:var(--cream-dim);height:42px;border-radius:100px;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:.5rem;padding:0 1.2rem;font-family:'DM Sans',sans-serif;font-weight:300;font-size:.7rem;letter-spacing:.1em;transition:all .3s ease}
.action-btn:hover{background:rgba(240,235,227,.1);border-color:rgba(240,235,227,.25);color:var(--cream)}
.action-btn svg{width:16px;height:16px}
.action-btn.heart-btn.liked{border-color:var(--heart);background:rgba(199,80,80,.1);color:var(--heart)}
.action-btn.heart-btn.liked svg{fill:var(--heart)}
.heart-pop{animation:heartPop .4s cubic-bezier(.17,.89,.32,1.49)}
@keyframes heartPop{0%{transform:scale(1)}50%{transform:scale(1.3)}100%{transform:scale(1)}}
.countdown{margin-top:2.5rem;font-family:'JetBrains Mono',monospace;font-weight:200;font-size:.6rem;letter-spacing:.3em;color:var(--cream-faint);text-align:center}
.countdown-label{font-family:'DM Sans',sans-serif;font-weight:300;font-size:.55rem;letter-spacing:.35em;text-transform:uppercase;color:rgba(240,235,227,.2);margin-bottom:.4rem}
.countdown-time{font-size:1.1rem;color:var(--gold-dim);letter-spacing:.2em}

.list-view{display:none;min-height:100vh;padding:5.5rem 2rem 3rem;position:relative;z-index:1;max-width:720px;margin:0 auto}
.list-view.active{display:block}
.list-header{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:2rem;gap:1rem}
.list-title{font-family:'Playfair Display',serif;font-weight:400;font-size:1.3rem;color:var(--cream)}
.list-title-tag{color:var(--gold)}
.list-subtitle{font-size:.6rem;letter-spacing:.2em;text-transform:uppercase;color:var(--cream-faint);margin-top:.3rem}
.list-back{background:none;border:1px solid var(--cream-faint);color:var(--cream-dim);padding:.5rem 1rem;border-radius:100px;cursor:pointer;font-family:'DM Sans',sans-serif;font-weight:300;font-size:.65rem;letter-spacing:.1em;transition:all .3s;white-space:nowrap;flex-shrink:0}
.list-back:hover{border-color:rgba(240,235,227,.35);color:var(--cream)}
.list-items{display:flex;flex-direction:column;gap:.6rem}
.list-item{padding:1.2rem 1.3rem;background:var(--surface);border:1px solid var(--cream-faint);border-radius:12px;cursor:pointer;transition:all .3s;display:flex;gap:1.2rem;align-items:flex-start}
.list-item:hover{border-color:var(--gold-dim);background:var(--surface-hi);transform:translateX(4px)}
.list-date-badge{flex-shrink:0;display:flex;flex-direction:column;align-items:center;min-width:48px;padding:.3rem 0}
.list-date-month{font-size:.5rem;letter-spacing:.2em;text-transform:uppercase;color:var(--gold-dim);font-weight:400}
.list-date-day{font-family:'JetBrains Mono',monospace;font-size:1.3rem;font-weight:200;color:var(--cream-dim);line-height:1.2}
.list-item-body{flex:1;min-width:0}
.list-item-quote{font-family:'Playfair Display',serif;font-style:italic;font-size:.95rem;line-height:1.65;color:var(--cream);margin-bottom:.5rem;display:-webkit-box;-webkit-line-clamp:3;-webkit-box-orient:vertical;overflow:hidden}
.list-item-author{font-size:.6rem;letter-spacing:.15em;text-transform:uppercase;color:var(--cream-dim);font-weight:300}
.list-empty{text-align:center;padding:3rem 1rem;color:var(--cream-faint);font-style:italic;font-size:.85rem}

.toast{position:fixed;bottom:3rem;left:50%;transform:translateX(-50%) translateY(20px);background:var(--surface);border:1px solid var(--cream-faint);color:var(--cream);padding:.7rem 1.4rem;border-radius:100px;font-size:.7rem;letter-spacing:.15em;font-weight:300;z-index:160;opacity:0;pointer-events:none;transition:all .4s cubic-bezier(.16,1,.3,1)}
.toast.show{opacity:1;transform:translateX(-50%) translateY(0)}
.like-float{position:fixed;pointer-events:none;z-index:90;font-size:.8rem;color:var(--heart);animation:floatUp 1s ease-out forwards}
@keyframes floatUp{0%{opacity:1;transform:translateY(0) scale(1)}100%{opacity:0;transform:translateY(-50px) scale(1.3)}}
.bottom-nav{position:fixed;bottom:0;left:0;right:0;z-index:50;display:flex;justify-content:center;align-items:center;gap:2rem;padding:1.8rem 2rem;background:linear-gradient(to top,var(--bg) 60%,transparent)}
.bottom-nav.hidden{display:none}
.nav-arrow{background:none;border:1px solid var(--cream-faint);color:var(--cream-dim);width:44px;height:44px;border-radius:50%;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .3s ease;font-size:1.1rem}
.nav-arrow:hover:not(:disabled){border-color:rgba(240,235,227,.35);color:var(--cream);background:var(--cream-ghost)}
.nav-arrow:disabled{opacity:.2;cursor:not-allowed}
.nav-center{display:flex;flex-direction:column;align-items:center;gap:.15rem;min-width:80px}
.nav-hint{font-weight:200;font-size:.5rem;letter-spacing:.3em;text-transform:uppercase;color:rgba(240,235,227,.15)}
.modal-overlay{position:fixed;inset:0;z-index:200;background:rgba(0,0,0,.85);backdrop-filter:blur(20px);display:flex;align-items:center;justify-content:center;padding:2rem;opacity:0;pointer-events:none;transition:opacity .4s ease}
.modal-overlay.open{opacity:1;pointer-events:auto}
.modal{background:var(--bg-warm);border:1px solid var(--cream-faint);border-radius:16px;padding:2rem;max-width:440px;width:100%;text-align:center;position:relative;transform:scale(.95) translateY(10px);transition:transform .4s cubic-bezier(.16,1,.3,1)}
.modal-overlay.open .modal{transform:scale(1) translateY(0)}
.modal-title{font-family:'Playfair Display',serif;font-weight:400;font-size:1.1rem;margin-bottom:1.2rem;color:var(--cream)}
.modal-preview{width:100%;border-radius:8px;margin-bottom:1.5rem;border:1px solid var(--cream-faint)}
.modal-actions{display:flex;gap:.6rem;justify-content:center;flex-wrap:wrap}
.modal-btn{background:var(--cream-ghost);border:1px solid var(--cream-faint);color:var(--cream);padding:.65rem 1.3rem;border-radius:100px;cursor:pointer;font-family:'DM Sans',sans-serif;font-weight:300;font-size:.7rem;letter-spacing:.1em;transition:all .3s ease;display:flex;align-items:center;gap:.4rem}
.modal-btn:hover{background:rgba(240,235,227,.1);border-color:rgba(240,235,227,.3)}
.modal-btn.primary{background:var(--gold);border-color:var(--gold);color:var(--bg);font-weight:400}
.modal-btn.primary:hover{background:#d4b578}
.modal-close{position:absolute;top:1rem;right:1rem;background:none;border:none;color:var(--cream-dim);cursor:pointer;font-size:1.2rem;padding:.5rem}
#shareCanvas{display:none}
@media(max-width:600px){
  .header{padding:1.2rem}.scene{padding:5rem 1.5rem 9rem}
  .quote{font-size:clamp(1.05rem,4.5vw,1.5rem)}
  .actions{gap:.35rem}.action-btn{height:38px;padding:0 1rem;font-size:.65rem}
  .bottom-nav{padding:1.5rem;gap:1.2rem}
  .panel{width:100%;max-width:100%}
  .list-view{padding:5rem 1.2rem 3rem}
  .list-item{padding:1rem;gap:.8rem}
}
</style>
</head>
<body>
<div class="grain"></div>
<div class="ambient"></div>
<header class="header">
  <div class="brand" id="brandHome">Axitome</div>
  <button class="menu-btn" id="menuBtn" aria-label="Menu"><span></span><span></span><span></span></button>
</header>
<div class="panel-overlay" id="panelOverlay"></div>
<div class="panel" id="panel">
  <div class="panel-header">
    <div class="panel-title">Explore</div>
    <div class="panel-search-wrap">
      <svg class="panel-search-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
      <input type="text" class="panel-search" id="searchInput" placeholder="Author, keyword, or phrase...">
    </div>
  </div>
  <div class="panel-body">
    <div class="section-label">Themes</div>
    <ul class="theme-list" id="themeList"></ul>
    <div class="section-label">Go to Date</div>
    <div class="date-section">
      <input type="date" class="date-input" id="dateInput">
      <button class="date-go-btn" id="dateGoBtn">Go to this date</button>
      <div class="date-range-hint" id="dateHint"></div>
    </div>
  </div>
</div>
<main class="scene" id="singleView">
  <div class="card" id="card">
    <div class="date-label" id="dateLabel"></div>
    <div class="quote-wrap">
      <span class="qmark open">&#8220;</span>
      <div class="quote" id="quoteText"></div>
      <span class="qmark close">&#8221;</span>
    </div>
    <div class="attribution">
      <div class="rule"></div>
      <div class="author" id="authorName"></div>
    </div>
    <div class="quote-tags" id="quoteTags"></div>
    <div class="actions">
      <button class="action-btn heart-btn" id="heartBtn">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/></svg>
        <span id="heartLabel">Like</span>
      </button>
      <button class="action-btn" id="copyBtn">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>
        Copy Quote
      </button>
      <button class="action-btn" id="shareBtn">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8"/><polyline points="16 6 12 2 8 6"/><line x1="12" y1="2" x2="12" y2="15"/></svg>
        Share
      </button>
    </div>
    <div class="countdown" id="countdownWrap">
      <div class="countdown-label">Next quote in</div>
      <div class="countdown-time" id="countdown"></div>
    </div>
  </div>
</main>
<div class="list-view" id="listView">
  <div class="list-header">
    <div>
      <div class="list-title" id="listTitle"></div>
      <div class="list-subtitle" id="listSubtitle"></div>
    </div>
    <button class="list-back" id="listBack">&#8592; Today</button>
  </div>
  <div class="list-items" id="listItems"></div>
</div>
<div class="toast" id="toast"></div>
<nav class="bottom-nav" id="bottomNav">
  <button class="nav-arrow" id="prevBtn">&#8592;</button>
  <div class="nav-center"><div class="nav-hint">&#8592; &#8594; keys</div></div>
  <button class="nav-arrow" id="nextBtn">&#8594;</button>
</nav>
<div class="modal-overlay" id="modalOverlay">
  <div class="modal">
    <button class="modal-close" id="modalClose">&times;</button>
    <div class="modal-title">Share this quote</div>
    <img class="modal-preview" id="modalPreview" alt="Preview">
    <div class="modal-actions">
      <button class="modal-btn primary" id="downloadCard">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
        Save Image
      </button>
      <button class="modal-btn" id="copyLink">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/></svg>
        Copy Link
      </button>
    </div>
  </div>
</div>
<canvas id="shareCanvas" width="1080" height="1080"></canvas>
<script>
var Q=[],currentIdx=0,busy=false,liked=new Set(),viewMode='single',likeCounts={};
var EPOCH=new Date(2026,0,1);
try{var _lk=JSON.parse(localStorage.getItem('axitome-likes')||'[]');_lk.forEach(function(i){liked.add(i)})}catch(e){}
function saveLikes(){try{localStorage.setItem('axitome-likes',JSON.stringify(Array.from(liked)))}catch(e){}}
function fetchLikes(){fetch('/api/likes').then(function(r){return r.json()}).then(function(d){likeCounts=d;updateHeartUI()}).catch(function(){})}
function postLike(idx,action){fetch('/api/likes',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({idx:idx,action:action})}).then(function(r){return r.json()}).then(function(d){likeCounts[String(idx)]=d.count;updateHeartUI()}).catch(function(){})}
function updateHeartUI(){var c=likeCounts[String(currentIdx)]||0;var lbl=document.getElementById('heartLabel');lbl.textContent=liked.has(currentIdx)?(c>0?c+' Liked':'Liked'):(c>0?c:'Like')}
var TAG_LABELS={action:'Action',character:'Character',courage:'Courage',creativity:'Creativity',death:'Death & Mortality',discipline:'Discipline',freedom:'Freedom',growth:'Growth',happiness:'Happiness',leadership:'Leadership',loss:'Loss',love:'Love',mind:'Mind & Thought',nature:'Nature',perseverance:'Perseverance',purpose:'Purpose',simplicity:'Simplicity',solitude:'Solitude',time:'Time',wisdom:'Wisdom'};
var TAGS_SORTED=Object.keys(TAG_LABELS).sort();

function daysBetween(a,b){return Math.floor((b-a)/864e5)}
function todayDate(){var d=new Date();return new Date(d.getFullYear(),d.getMonth(),d.getDate())}
function maxIdx(){return Math.min(daysBetween(EPOCH,todayDate()),Q.length-1)}
function idxToDate(i){var d=new Date(EPOCH);d.setDate(d.getDate()+i);return d}
function dateToIdx(d){var i=daysBetween(EPOCH,d);if(i<0||i>maxIdx())return-1;return i}
function fmtD(d){return d.toLocaleDateString('en-US',{weekday:'long',month:'long',day:'numeric',year:'numeric'})}
function isToday(i){return i===maxIdx()}
function idxToDateStr(i){var d=idxToDate(i);return d.getFullYear()+'-'+String(d.getMonth()+1).padStart(2,'0')+'-'+String(d.getDate()).padStart(2,'0')}
function dateStrToIdx(s){var p=s.split('-');if(p.length!==3)return-1;var d=new Date(parseInt(p[0]),parseInt(p[1])-1,parseInt(p[2]));return dateToIdx(d)}
function parseHash(){var h=location.hash;var dm=h.match(/#(\d{4}-\d{2}-\d{2})/);if(dm)return dateStrToIdx(dm[1]);var om=h.match(/#day\/(\d+)/);if(om)return Math.max(0,Math.min(parseInt(om[1])-1,maxIdx()));return-1}
function escH(s){return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;')}

function updateCD(){
  var now=new Date(),tmrw=new Date(now.getFullYear(),now.getMonth(),now.getDate()+1),d=tmrw-now;
  var el=document.getElementById('countdown');
  if(el)el.textContent=
    String(Math.floor(d/36e5)).padStart(2,'0')+' : '+
    String(Math.floor((d%36e5)/6e4)).padStart(2,'0')+' : '+
    String(Math.floor((d%6e4)/1e3)).padStart(2,'0');
}

function showSingleView(){
  viewMode='single';
  document.getElementById('singleView').classList.remove('hidden');
  document.getElementById('listView').classList.remove('active');
  document.getElementById('bottomNav').classList.remove('hidden');
}

function showListView(title,subtitle,items){
  viewMode='list';
  document.getElementById('singleView').classList.add('hidden');
  document.getElementById('bottomNav').classList.add('hidden');
  document.getElementById('listView').classList.add('active');
  document.getElementById('listTitle').innerHTML=title;
  document.getElementById('listSubtitle').textContent=subtitle;
  var container=document.getElementById('listItems');
  if(!items.length){container.innerHTML='<div class="list-empty">No quotes found</div>';return}
  var html='';
  items.forEach(function(r){
    var d=idxToDate(r.idx);
    var mon=d.toLocaleDateString('en-US',{month:'short'}).toUpperCase();
    var day=d.getDate();
    html+='<div class="list-item" data-idx="'+r.idx+'">';
    html+='<div class="list-date-badge"><span class="list-date-month">'+mon+'</span><span class="list-date-day">'+day+'</span></div>';
    html+='<div class="list-item-body">';
    html+='<div class="list-item-quote">'+escH(r.q.q)+'</div>';
    html+='<div class="list-item-author">'+escH(r.q.a)+'</div>';
    html+='</div></div>';
  });
  container.innerHTML=html;
  container.querySelectorAll('.list-item').forEach(function(el){
    el.addEventListener('click',function(){
      showSingleView();show(parseInt(this.getAttribute('data-idx')),false);
    });
  });
  window.scrollTo({top:0,behavior:'smooth'});
}

function show(idx,anim){
  if(busy||!Q.length)return;busy=true;
  idx=Math.max(0,Math.min(idx,maxIdx()));
  var card=document.getElementById('card');
  function doShow(){
    currentIdx=idx;var q=Q[idx];var d=idxToDate(idx);var td=isToday(idx);
    history.replaceState(null,'','#'+idxToDateStr(idx));
    document.getElementById('dateLabel').innerHTML=(td?'<span class="today-dot"></span>today &mdash; ':'')+fmtD(d);
    document.getElementById('quoteText').textContent=q.q;
    document.getElementById('authorName').textContent=q.a;
    var tagsEl=document.getElementById('quoteTags');tagsEl.innerHTML='';
    if(q.t){q.t.forEach(function(t){
      var sp=document.createElement('span');sp.className='quote-tag';sp.textContent=t;
      sp.addEventListener('click',function(){filterByTag(t)});
      tagsEl.appendChild(sp);
    })}
    document.getElementById('nextBtn').disabled=td;
    document.getElementById('prevBtn').disabled=(idx===0);
    var hb=document.getElementById('heartBtn');
    hb.classList.toggle('liked',liked.has(idx));
    updateHeartUI();
    document.getElementById('countdownWrap').style.display=td?'':'none';
    if(anim){card.classList.remove('exit');card.style.animation='none';card.offsetHeight;card.style.animation=''}
    busy=false;
  }
  if(anim){card.classList.add('exit');setTimeout(doShow,400)}else{doShow()}
}

function toast(msg){
  var t=document.getElementById('toast');t.textContent=msg;
  t.classList.add('show');setTimeout(function(){t.classList.remove('show')},2200);
}

/* Panel */
function openPanel(){document.getElementById('panel').classList.add('open');document.getElementById('panelOverlay').classList.add('open');document.getElementById('menuBtn').classList.add('open')}
function closePanel(){document.getElementById('panel').classList.remove('open');document.getElementById('panelOverlay').classList.remove('open');document.getElementById('menuBtn').classList.remove('open')}
document.getElementById('menuBtn').addEventListener('click',function(){
  if(this.classList.contains('open'))closePanel();else openPanel();
});
document.getElementById('panelOverlay').addEventListener('click',closePanel);

/* Themes */
function buildThemes(){
  var mx=maxIdx(),container=document.getElementById('themeList'),counts={};
  for(var i=0;i<=mx&&i<Q.length;i++){
    if(Q[i].t)Q[i].t.forEach(function(t){counts[t]=(counts[t]||0)+1});
  }
  TAGS_SORTED.forEach(function(tag){
    if(!counts[tag])return;
    var li=document.createElement('li');li.className='theme-item';
    li.innerHTML='<span class="theme-name">'+(TAG_LABELS[tag]||tag)+'</span><div class="theme-meta"><span class="theme-count">'+counts[tag]+'</span><span class="theme-arrow">&rsaquo;</span></div>';
    li.addEventListener('click',function(){filterByTag(tag)});
    container.appendChild(li);
  });
}

function filterByTag(tag){
  closePanel();
  var mx=maxIdx(),items=[];
  for(var i=0;i<=mx&&i<Q.length;i++){
    if(Q[i].t&&Q[i].t.indexOf(tag)!==-1)items.push({idx:i,q:Q[i]});
  }
  showListView('Quotes on <span class="list-title-tag">'+(TAG_LABELS[tag]||tag)+'</span>',items.length+' quote'+(items.length===1?'':'s'),items);
}

/* Search */
function doSearch(){
  var query=document.getElementById('searchInput').value.trim().toLowerCase();
  if(!query)return;
  closePanel();
  var mx=maxIdx(),items=[];
  for(var i=0;i<=mx&&i<Q.length;i++){
    var q=Q[i];
    var hay=(q.q+' '+q.a+' '+(q.t?q.t.join(' '):'')).toLowerCase();
    if(hay.indexOf(query)!==-1)items.push({idx:i,q:q});
  }
  showListView('Results for \u201C'+escH(query)+'\u201D',items.length+' quote'+(items.length===1?'':'s'),items);
}
document.getElementById('searchInput').addEventListener('keydown',function(e){if(e.key==='Enter')doSearch()});

/* Date picker */
document.getElementById('dateGoBtn').addEventListener('click',function(){
  var val=document.getElementById('dateInput').value;
  if(!val)return;
  var parts=val.split('-');
  var d=new Date(parseInt(parts[0]),parseInt(parts[1])-1,parseInt(parts[2]));
  var idx=dateToIdx(d);
  if(idx<0){toast('That date is outside the available range');return}
  closePanel();showSingleView();show(idx,true);
});

/* Back / Brand */
document.getElementById('listBack').addEventListener('click',function(){showSingleView();show(maxIdx(),true)});
document.getElementById('brandHome').addEventListener('click',function(){
  if(viewMode==='list'){showSingleView();show(maxIdx(),true)}else{show(maxIdx(),true)}
});

/* Like */
document.getElementById('heartBtn').addEventListener('click',function(){
  var btn=this;
  if(liked.has(currentIdx)){
    liked.delete(currentIdx);btn.classList.remove('liked');
    postLike(currentIdx,'unlike');
  } else {
    liked.add(currentIdx);btn.classList.add('liked','heart-pop');
    setTimeout(function(){btn.classList.remove('heart-pop')},400);
    var r=btn.getBoundingClientRect();var fl=document.createElement('div');
    fl.className='like-float';fl.textContent='\u2665';
    fl.style.left=(r.left+r.width/2-6)+'px';fl.style.top=(r.top-10)+'px';
    document.body.appendChild(fl);setTimeout(function(){fl.remove()},1000);
    postLike(currentIdx,'like');
  }
  saveLikes();updateHeartUI();
});

/* Copy Quote */
document.getElementById('copyBtn').addEventListener('click',function(){
  var q=Q[currentIdx];
  navigator.clipboard.writeText('\u201C'+q.q+'\u201D\n\n\u2014 '+q.a).then(function(){toast('Quote copied')});
});

/* Share card */
function genCard(){
  var c=document.getElementById('shareCanvas'),ctx=c.getContext('2d'),W=1080,H=1080;
  c.width=W;c.height=H;var q=Q[currentIdx];
  var g=ctx.createLinearGradient(0,0,0,H);
  g.addColorStop(0,'#161413');g.addColorStop(.5,'#111010');g.addColorStop(1,'#0d0c0b');
  ctx.fillStyle=g;ctx.fillRect(0,0,W,H);
  var rg=ctx.createRadialGradient(W/2,H*.35,0,W/2,H*.35,W*.5);
  rg.addColorStop(0,'rgba(200,168,110,0.06)');rg.addColorStop(1,'transparent');
  ctx.fillStyle=rg;ctx.fillRect(0,0,W,H);
  ctx.fillStyle='rgba(200,168,110,0.35)';ctx.font='italic 140px Georgia,serif';
  ctx.textAlign='center';ctx.fillText('\u201C',W/2,240);
  ctx.fillStyle='#f0ebe3';
  var fs=q.q.length>300?32:q.q.length>150?38:44;
  ctx.font='italic '+fs+'px Georgia,serif';
  var mW=W-180,words=q.q.split(' '),lines=[],ln='';
  for(var i=0;i<words.length;i++){var t=ln+(ln?' ':'')+words[i];if(ctx.measureText(t).width>mW&&ln){lines.push(ln);ln=words[i]}else{ln=t}}
  if(ln)lines.push(ln);
  var lH=fs*1.7,tH=lines.length*lH,sY=(H-tH)/2+40;
  for(var i=0;i<lines.length;i++)ctx.fillText(lines[i],W/2,sY+i*lH);
  ctx.fillStyle='rgba(200,168,110,0.35)';ctx.font='italic 140px Georgia,serif';
  ctx.fillText('\u201D',W/2,sY+lines.length*lH+60);
  var rY=sY+lines.length*lH+110;
  ctx.strokeStyle='rgba(200,168,110,0.3)';ctx.lineWidth=1;
  ctx.beginPath();ctx.moveTo(W/2-30,rY);ctx.lineTo(W/2+30,rY);ctx.stroke();
  ctx.fillStyle='rgba(240,235,227,0.5)';ctx.font='300 22px sans-serif';
  ctx.fillText(q.a.toUpperCase(),W/2,rY+45);
  if(q.t&&q.t.length){ctx.fillStyle='rgba(200,168,110,0.25)';ctx.font='200 16px sans-serif';ctx.fillText(q.t.map(function(t){return'#'+t}).join('  '),W/2,rY+80)}
  ctx.fillStyle='rgba(240,235,227,0.12)';ctx.font='200 14px sans-serif';
  ctx.fillText('AXITOME',W/2,H-50);
  return c.toDataURL('image/png');
}
document.getElementById('shareBtn').addEventListener('click',function(){document.getElementById('modalPreview').src=genCard();document.getElementById('modalOverlay').classList.add('open')});
document.getElementById('downloadCard').addEventListener('click',function(){var a=document.createElement('a');a.download='axitome-'+idxToDateStr(currentIdx)+'.png';a.href=genCard();a.click();toast('Image saved')});
document.getElementById('copyLink').addEventListener('click',function(){navigator.clipboard.writeText(location.origin+location.pathname+'#'+idxToDateStr(currentIdx)).then(function(){toast('Link copied')})});
document.getElementById('modalClose').addEventListener('click',function(){document.getElementById('modalOverlay').classList.remove('open')});
document.getElementById('modalOverlay').addEventListener('click',function(e){if(e.target===e.currentTarget)e.currentTarget.classList.remove('open')});

/* Nav */
document.getElementById('prevBtn').addEventListener('click',function(){if(currentIdx>0)show(currentIdx-1,true)});
document.getElementById('nextBtn').addEventListener('click',function(){if(currentIdx<maxIdx())show(currentIdx+1,true)});
document.addEventListener('keydown',function(e){
  if(e.target.tagName==='INPUT')return;
  if(viewMode!=='single')return;
  if(e.key==='ArrowLeft'&&currentIdx>0)show(currentIdx-1,true);
  if(e.key==='ArrowRight'&&currentIdx<maxIdx())show(currentIdx+1,true);
  if(e.key==='Escape'){document.getElementById('modalOverlay').classList.remove('open');closePanel()}
});
var tx=0;
document.addEventListener('touchstart',function(e){tx=e.changedTouches[0].screenX},{passive:true});
document.addEventListener('touchend',function(e){
  if(document.getElementById('panel').classList.contains('open'))return;
  if(viewMode!=='single')return;
  var d=e.changedTouches[0].screenX-tx;
  if(Math.abs(d)>60){if(d>0&&currentIdx>0)show(currentIdx-1,true);else if(d<0&&currentIdx<maxIdx())show(currentIdx+1,true)}
});

/* Init - fetch quotes from external JSON */
fetch('quotes.json')
  .then(function(r){return r.json()})
  .then(function(data){
    Q=data;
    var di=document.getElementById('dateInput');
    di.min=EPOCH.toISOString().split('T')[0];
    di.max=todayDate().toISOString().split('T')[0];
    di.value=di.max;
    document.getElementById('dateHint').textContent='Jan 1, 2026 \u2013 Today';
    buildThemes();
    updateCD();setInterval(updateCD,1000);
    var startIdx=parseHash();
    var start=startIdx>=0?Math.max(0,Math.min(startIdx,maxIdx())):maxIdx();
    show(start,false);
    fetchLikes();
    window.addEventListener('hashchange',function(){
      var hi=parseHash();
      if(hi>=0){showSingleView();show(Math.max(0,Math.min(hi,maxIdx())),true)}
    });
  })
  .catch(function(e){
    console.error('Failed to load quotes:',e);
    document.getElementById('quoteText').textContent='Failed to load quotes. Please refresh.';
  });
</script>
</body>
</html>
